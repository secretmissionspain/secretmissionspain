<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Misión Clasificada</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Courier+Prime:wght@400;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: linear-gradient(45deg, #1a1a1a 0%, #2d2d2d 50%, #1a1a1a 100%);
            color: #00ff41;
            font-family: 'Courier Prime', monospace;
            min-height: 100vh;
            padding: 20px;
            background-image: 
                radial-gradient(circle at 25% 25%, rgba(0, 255, 65, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 75% 75%, rgba(0, 255, 65, 0.1) 0%, transparent 50%);
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: rgba(0, 0, 0, 0.8);
            border: 2px solid #00ff41;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 
                0 0 20px rgba(0, 255, 65, 0.3),
                inset 0 0 20px rgba(0, 255, 65, 0.1);
            position: relative;
        }
        
        .container::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(45deg, #00ff41, #008f11, #00ff41);
            z-index: -1;
            border-radius: 12px;
            animation: borderGlow 2s linear infinite;
        }
        
        @keyframes borderGlow {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            position: relative;
        }
        
        .header::after {
            content: 'CLASIFICADO';
            position: absolute;
            top: -15px;
            right: -15px;
            background: #ff0000;
            color: white;
            padding: 5px 10px;
            font-size: 12px;
            font-weight: bold;
            transform: rotate(15deg);
            border-radius: 3px;
        }
        
        .typewriter-text {
            font-size: 16px;
            line-height: 1.6;
            margin-bottom: 20px;
            text-shadow: 0 0 5px rgba(0, 255, 65, 0.5);
        }
        
        .cursor {
            display: inline-block;
            background-color: #00ff41;
            width: 2px;
            height: 1.2em;
            animation: blink 1s infinite;
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }
        
        .coordinates {
            font-size: 18px;
            font-weight: bold;
            text-align: center;
            margin: 30px 0;
            padding: 15px;
            border: 1px dashed #00ff41;
            background: rgba(0, 255, 65, 0.1);
            letter-spacing: 2px;
        }
        
        .help-section {
            text-align: center;
            margin: 30px 0;
        }
        
        .help-button {
            background: linear-gradient(45deg, #ff6b35, #f7931e);
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            border-radius: 5px;
            text-transform: uppercase;
            letter-spacing: 2px;
            box-shadow: 0 4px 15px rgba(255, 107, 53, 0.3);
            transition: all 0.3s ease;
            font-family: 'Courier Prime', monospace;
        }
        
        .help-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 107, 53, 0.4);
        }
        
        .help-image {
            display: none;
            margin-top: 20px;
            text-align: center;
        }
        
        .help-image.show {
            display: block;
            animation: fadeIn 0.5s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .help-placeholder {
            width: 634px;
            height: 173px;
            max-width: 100%;
            border: 2px dashed #00ff41;
            background: rgba(0, 255, 65, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto;
            color: #00ff41;
            font-size: 14px;
        }
        
        .mission-form {
            margin-top: 40px;
            padding: 20px;
            border: 1px solid #00ff41;
            border-radius: 5px;
            background: rgba(0, 255, 65, 0.05);
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 10px;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        textarea {
            width: 100%;
            min-height: 120px;
            background: rgba(0, 0, 0, 0.7);
            border: 2px solid #00ff41;
            color: #00ff41;
            padding: 15px;
            font-family: 'Courier Prime', monospace;
            font-size: 14px;
            border-radius: 5px;
            resize: vertical;
        }
        
        textarea:focus {
            outline: none;
            box-shadow: 0 0 10px rgba(0, 255, 65, 0.5);
        }
        
        textarea::placeholder {
            color: rgba(0, 255, 65, 0.6);
        }
        
        .submit-button {
            background: linear-gradient(45deg, #00ff41, #008f11);
            color: black;
            border: none;
            padding: 15px 40px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            border-radius: 5px;
            text-transform: uppercase;
            letter-spacing: 2px;
            transition: all 0.3s ease;
            font-family: 'Courier Prime', monospace;
            width: 100%;
            margin-top: 10px;
        }
        
        .submit-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 255, 65, 0.4);
        }
        
        .submit-button:disabled {
            background: #666;
            color: #999;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .cooldown-message {
            display: none;
            color: #ff6b35;
            font-size: 14px;
            margin-top: 10px;
            text-align: center;
        }
        
        .success-message {
            display: none;
            color: #00ff41;
            font-size: 14px;
            margin-top: 10px;
            text-align: center;
            padding: 10px;
            border: 1px solid #00ff41;
            border-radius: 5px;
            background: rgba(0, 255, 65, 0.1);
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 20px;
                margin: 10px;
            }
            
            .typewriter-text {
                font-size: 14px;
            }
            
            .coordinates {
                font-size: 16px;
                letter-spacing: 1px;
            }
            
            .help-button {
                padding: 12px 20px;
                font-size: 14px;
            }
            
            .help-placeholder {
                width: 100%;
                height: auto;
                min-height: 120px;
                font-size: 12px;
            }
        }
        
        @media (max-width: 480px) {
            .container {
                padding: 15px;
                margin: 5px;
            }
            
            .typewriter-text {
                font-size: 13px;
            }
            
            .coordinates {
                font-size: 14px;
                padding: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>MISIÓN CLASIFICADA</h1>
        </div>
        
        <div id="typewriter-container">
            <div class="typewriter-text" id="typewriter"></div>
            <span class="cursor" id="cursor"></span>
        </div>
        
        <div class="coordinates" id="coordinates-section" style="display: none;">
            40°45'10.7"N 3°09'54.8"W
        </div>
        
        <div class="help-section" id="help-section" style="display: none;">
            <button class="help-button" onclick="toggleHelp()">AYUDA</button>
            <div class="help-image" id="help-image">
                <img src="maps.png" alt="Mapa de ayuda" style="width: 100%; max-width: 634px; height: auto; border: 2px solid #00ff41; border-radius: 5px;">
            </div>
        </div>
        
        <div class="mission-form" id="mission-form" style="display: none;">
            <div class="form-group">
                <label for="mission-info">Información de la Misión:</label>
                <textarea 
                    id="mission-info" 
                    name="mission-info" 
                    placeholder="Escriba aquí el nombre del establecimiento y cualquier información adicional que desee proporcionar..."
                    required></textarea>
            </div>
            
            <button type="button" class="submit-button" id="submit-btn" onclick="submitMission()">
                ENVIAR INFORMACIÓN
            </button>
            
            <div class="cooldown-message" id="cooldown-msg">
                Debe esperar antes de enviar otra información. Tiempo restante: <span id="countdown"></span>
            </div>
            
            <div class="success-message" id="success-msg">
                Información enviada exitosamente. Espere nuevas instrucciones.
            </div>
        </div>
    </div>

    <script>
        const fullText = `Buenas agente... Tiene a la dirección visiblemente decepcionada. Había muchas esperanzas puestas en usted. Me ha costado convencerles de mantenerle en la misión, no me decepcione... Esperemos que los millones que se ha gastado la organización en su formación hayan merecido la pena.

Para la siguiente misión nos tiene que dar el nombre de un establecimiento, quizás un hotel, un restaurante, mmm, no sabemos bien, pero según nuestros informadores no le es ajeno ni a usted ni a su familia. Lo único que nos han dicho los informadores es lo siguiente:`;

        let currentIndex = 0;
        let isTyping = true;
        
        // Control de cooldown para prevenir spam
        let lastSubmissionTime = 0;
        const COOLDOWN_PERIOD = 120000; // 2 minutos en milisegundos
        
        function typeWriter() {
            const typewriterElement = document.getElementById('typewriter');
            const cursor = document.getElementById('cursor');
            
            if (currentIndex < fullText.length) {
                if (fullText.charAt(currentIndex) === '\n') {
                    typewriterElement.innerHTML += '<br><br>';
                } else {
                    typewriterElement.innerHTML += fullText.charAt(currentIndex);
                }
                currentIndex++;
                setTimeout(typeWriter, 50 + Math.random() * 30); // Velocidad variable para simular máquina de escribir real
            } else {
                isTyping = false;
                cursor.style.display = 'none';
                showNextSection();
            }
        }
        
        function showNextSection() {
            setTimeout(() => {
                document.getElementById('coordinates-section').style.display = 'block';
                setTimeout(() => {
                    document.getElementById('help-section').style.display = 'block';
                    setTimeout(() => {
                        document.getElementById('mission-form').style.display = 'block';
                    }, 1000);
                }, 1000);
            }, 500);
        }
        
        function toggleHelp() {
            const helpImage = document.getElementById('help-image');
            helpImage.classList.toggle('show');
        }
        
        async function submitMission() {
            const currentTime = Date.now();
            const timeSinceLastSubmission = currentTime - lastSubmissionTime;
            
            if (timeSinceLastSubmission < COOLDOWN_PERIOD) {
                showCooldownMessage(COOLDOWN_PERIOD - timeSinceLastSubmission);
                return;
            }
            
            const missionInfo = document.getElementById('mission-info').value.trim();
            
            if (!missionInfo) {
                alert('Por favor, ingrese la información requerida antes de enviar.');
                return;
            }
            
            // Deshabilitar botón durante el envío
            const submitBtn = document.getElementById('submit-btn');
            submitBtn.disabled = true;
            submitBtn.textContent = 'ENVIANDO...';
            
            const success = await sendEmail(missionInfo);
            
            if (success) {
                lastSubmissionTime = currentTime;
                showSuccessMessage();
                // Limpiar el formulario
                document.getElementById('mission-info').value = '';
            }
            
            // Rehabilitar botón
            submitBtn.disabled = false;
            submitBtn.textContent = 'ENVIAR INFORMACIÓN';
        }
        
        async function sendEmail(content) {
            try {
                // Reemplaza 'TU_FORM_ID' con el ID que te dé Formspree
                const response = await fetch('https://formspree.io/f/xblovlaz', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        email: 'cosasvarias193@gmail.com,enriquecperez@gmail.com',
                        subject: 'Información de Misión - Agente',
                        message: `Información del establecimiento:\n\n${content}\n\nEnviado desde: Misión Clasificada`
                    })
                });
                
                if (!response.ok) {
                    throw new Error('Error en el envío');
                }
                
                return true;
            } catch (error) {
                console.error('Error enviando email:', error);
                alert('Error al enviar. Por favor, inténtelo de nuevo.');
                return false;
            }
        }
        
        function showCooldownMessage(remainingTime) {
            const submitBtn = document.getElementById('submit-btn');
            const cooldownMsg = document.getElementById('cooldown-msg');
            const countdown = document.getElementById('countdown');
            
            submitBtn.disabled = true;
            cooldownMsg.style.display = 'block';
            
            const updateCountdown = () => {
                const remaining = Math.ceil(remainingTime / 1000);
                const minutes = Math.floor(remaining / 60);
                const seconds = remaining % 60;
                countdown.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
                
                if (remaining <= 0) {
                    submitBtn.disabled = false;
                    cooldownMsg.style.display = 'none';
                    clearInterval(countdownInterval);
                } else {
                    remainingTime -= 1000;
                }
            };
            
            updateCountdown();
            const countdownInterval = setInterval(updateCountdown, 1000);
        }
        
        function showSuccessMessage() {
            const successMsg = document.getElementById('success-msg');
            successMsg.style.display = 'block';
            
            setTimeout(() => {
                successMsg.style.display = 'none';
            }, 5000);
        }
        
        // Iniciar el efecto de máquina de escribir cuando la página carga
        window.addEventListener('load', () => {
            setTimeout(typeWriter, 1000);
        });
        
        // Prevenir envío múltiple accidental
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Enter' && (e.ctrlKey || e.metaKey)) {
                e.preventDefault();
                submitMission();
            }
        });
    </script>
</body>
</html>
